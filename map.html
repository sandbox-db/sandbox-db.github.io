<!DOCTYPE html>
<html lang="en">
   <head>
       <link rel="stylesheet" href="leaflet/leaflet.css"/>
        <!-- Make sure you put this AFTER Leaflet's CSS -->
       <script src="leaflet/leaflet.js"></script>
       <!-- Trying out fullscale on mobile device-->
       <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
   </head>
   <body>
       Last updated 2021/07/11 @ 14:38 EST
       <div id="map">
       </div>
       <script>
         //Define icons
         //https://thenounproject.com/coquet_adrien/collection/locations/ <-- winner
         //https://thenounproject.com/Flatart/collection/map-pin-v-31/ <-- Alternate
         //https://thenounproject.com/WSD/collection/wsd-map-markers/ <--Alternate
         //Hex colors
         // Nature #56903A may green
         // Water #135387 Blue
         // Brewsky #c4931f burn orange
         // distillery copper #b34a00
         // National park color #6F4930 coffee
         // Lodging black #000000 
         
	     var top_brewery = L.icon({
               iconUrl: 'leaflet/images/top_beer.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
            });
         var brewery = L.icon({
               iconUrl: 'leaflet/images/beer.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
            });
         var distillery = L.icon({
               iconUrl: 'leaflet/images/distillery.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] //point from which the popup should open relative to the iconAnchor
          });
         var lodging = L.icon({
               iconUrl: 'leaflet/images/hotel.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] //point from which the popup should open relative to the iconAnchor
          });
          var camping = L.icon({
               iconUrl: 'leaflet/images/camping_fire.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] //point from which the popup should open relative to the iconAnchor
          });
          var natl_park = L.icon({
               iconUrl: 'leaflet/images/national_park_brown.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] //point from which the popup should open relative to the iconAnchor
          });
          var hiking = L.icon({
               iconUrl: 'leaflet/images/hiking.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] //point from which the popup should open relative to the iconAnchor
          });
          var mountain = L.icon({
               iconUrl: 'leaflet/images/mountain.png', //make sure this is the correct path
               iconSize:     [40, 60], // size of the icon
               iconAnchor:   [19, 1], // point of the icon which will correspond to marker's location
               popupAnchor:  [0, 0] //point from which the popup should open relative to the iconAnchor
          });
         
         //
         var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
		              'Imagery &copy; <a href="https://www.mapbox.com/">Mapbox</a>',
		     mbUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

	     var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox/light-v9', tileSize: 512, zoomOffset: -1, attribution: mbAttr}),
		     streets  = L.tileLayer(mbUrl, {id: 'mapbox/streets-v11', tileSize: 512, zoomOffset: -1, attribution: mbAttr});
         
         var baseMaps = {
               "Grayscale": grayscale,
               "Streets": streets
         };
         
         //https://github.com/Leaflet/Leaflet/issues/7331#issuecomment-742454380
         //https://gis.stackexchange.com/a/271616 
	     var mymap = L.map('map',{tap: false}).setView([43.997512, -70.894775], 8); //larger number more zoom
	     
	     
	     //Add breweries 
	     var Hill = L.marker([44.60663, -72.26347],{icon: top_brewery}).bindPopup("<a href='http://www.hillfarmstead.com' target='_blank'>Hill Farmstead Brewery</a>");
	     var Alchemist = L.marker([44.47742867998274, -72.71614119282586],{icon: top_brewery}).bindPopup("<a href='https://alchemistbeer.com' target='_blank'>The Alchemist Stowe</a>");
	     var Treehouse = L.marker([42.13681394517929, -72.0124116036083],{icon: top_brewery}).bindPopup("<a href='https://treehousebrew.com' target='_blank'>Tree House Brewing Company #5</a>");
	     var Maine = L.marker([43.83967505759322, -70.12118027288436],{icon: top_brewery}).bindPopup("<a href='http://www.mainebeercompany.com' target='_blank'>Maine Beer Company #32</a>");
	     var Allagash = L.marker([43.70321954096549, -70.31766391695535],{icon: brewery}).bindPopup("<a href='https://www.allagash.com' target='_blank'>Allagash Brewing Company #33</a>");
	     var Trillium = L.marker([42.352332455033526, -71.04736171328432],{icon: brewery}).bindPopup("<a href='https://www.trilliumbrewing.com/locations/fort-point' target='_blank'>Trillium Brewing Company #4</a>");
	     var Jacks = L.marker([42.280298727751145, -71.41120478390016],{icon: brewery}).bindPopup("<a href='https://jacksabby.com' target='_blank'>Jack&#39;s Abby Craft Lagers #39</a>");
	     var Lawson = L.marker([44.18794642455557, -72.83503345386575],{icon: brewery}).bindPopup("<a href='https://www.lawsonsfinest.com' target='_blank'>Lawson&#39;s Finest Liquids</a>");
	     
	     
	     //Add distilleries
	     var Smuggler = L.marker([44.64749800557561, -72.83109698635812],{icon: distillery}).bindPopup("<a href='https://www.smugglersnotchdistillery.com/?age-verified=97f42013e6' target='_blank'>Smuggler&#39;s Notch Distillery</a>");
	     var Sons = L.marker([41.45462626653591, -71.5049001367355],{icon: distillery}).bindPopup("<a href='http://www.solspirits.com' target='_blank'>Sons of Liberty Spirits Co.</a>");
	     
	     
	     //Add lodging (order by stay date)
	     var Sugarloaf = L.marker([44.26043145366312, -71.50469001528825],{icon: camping}).bindPopup("<a href='https://www.recreation.gov/camping/campgrounds/232177?tab=info' targer='_blank'>Sugarloaf 1 Campground</a>");
	     var Blackmtn  = L.marker([44.197617073147484, -71.17174076908847],{icon: camping}).bindPopup("<a href='https://www.recreation.gov/camping/campgrounds/234237' target='_blank'>Black Mountain Cabin</a>");
	     var Seawall   = L.marker([44.24216010405409, -68.30592009994584],{icon: camping}).bindPopup("<a href='https://www.recreation.gov/camping/campgrounds/234674' target='_blank'>Seawall Campground</a>");
	     var HarborView   = L.marker([44.27781818968163, -68.32435780364541],{icon: lodging}).bindPopup("<a href='https://www.harborviewmotelandcottages.com/area' target='_blank'>Harbor View Motel & Cottages</a>");
	     var Jigger   = L.marker([43.99517403698421, -71.33549803063784],{icon: camping}).bindPopup("<a href='https://www.fs.usda.gov/recarea/whitemountain/recarea/?recid=74865' target='_blank'>Jigger Johnson Campground</a>");
	     var DryRiver   = L.marker([44.15512, -71.36292],{icon: camping}).bindPopup("Coin operated showers");
         var FlowerFarm = L.marker([44.25050251668252, -72.76061422886889],{icon: lodging}).bindPopup("<a href='https://www.airbnb.com/rooms/40668531?source_impression_id=p3_1626027512_eeKtH2mW2GfiGjPK&guests=1&adults=1' target='_blank'>airbnb Flower Farm</a>");
         
	     //Add Nature
	     var Acadia = L.marker([44.337960188718434, -68.28033645025478],{icon: natl_park}).bindPopup("<a href='https://www.nps.gov/acad/index.htm' targer='_blank'>Acadia National Park</a>");
	     var MntPisgah = L.marker([44.73047284719918, -72.03088810875747],{icon: mountain}).bindPopup("<a href='https://www.alltrails.com/explore/trail/us/vermont/mount-pisgah-trail' targer='_blank'>1) Mount Pisgah Trail</a></br><a href='https://www.alltrails.com/explore/trail/us/vermont/north-trail-mount-pisgah' targer='_blank'>2) Mount Pisgah Via N. Trail</a>");
	     var Moosalamoo = L.marker([43.91844, -73.02535],{icon: hiking}).bindPopup("<a href='https://www.alltrails.com/trail/us/vermont/mount-moosalamoo-campground-trail' targer='_blank'>Mount Moosalamoo Trail</a>");
	     
	     //Add labels or popups in html format
         let isClicked = false
           
         Hill.on({
             mouseover: function() {
                 if(!isClicked) {
                     this.openPopup()
                 }
             },
             mouseout: function() { 
                 if(!isClicked) {
                     this.closePopup()
                 }
             },
             click: function() {
                 isClicked = true
                 this.openPopup()
             }
         })
           
         mymap.on ({
             click: function() {
                 isClicked = false
             },
             popupclose: function () {
                 isClicked = false
             }
         })
         //END of labels and popups
         
         // Add layers
         var breweries = L.layerGroup([Hill,Alchemist,Treehouse,Maine,Allagash,Trillium,Jacks,Lawson]);
         var stills = L.layerGroup([Smuggler,Sons]);
         var lodging = L.layerGroup([Sugarloaf,Blackmtn,Seawall,HarborView,Jigger,DryRiver,FlowerFarm]);
         var nature = L.layerGroup([Acadia,MntPisgah,Moosalamoo]);
         
         var overlayMaps = {
               "Breweries": breweries,
               "Distilleries": stills,
               "Nature": nature,
               "ZzzZzz's": lodging
           };
           
         mymap.addLayer(breweries);
         mymap.addLayer(stills);
         mymap.addLayer(nature);
         mymap.addLayer(lodging);

	     
	     L.tileLayer(mbUrl, //'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		       {maxZoom: 18,
		       attribution: mbAttr,
		       id: 'mapbox/light-v9',
		       tileSize: 512,
		       zoomOffset: -1
	      }).addTo(mymap);
	      
	      // Where is this?
	      var popup = L.popup();
          function onMapClick(e) {
              popup
                  .setLatLng(e.latlng)
                  .setContent("You clicked the map at " + e.latlng.toString())
                  .openOn(mymap);
          }
          
          mymap.on('click', onMapClick);
         
         // Dynamic me
         // https://gis.stackexchange.com/a/259983 <--kinda works but doesn't clear location and keeps adding markers
         // https://stackoverflow.com/a/22602096 <-- untested...
         // https://gis.stackexchange.com/a/342074 <-- promising ?
         // https://gitlab.com/IvanSanchez/Leaflet.Marker.SlideTo
         var gpsMarker = null;
         var gpsCircleMarker;

         function onLocationFound(e) {
            var radius = e.accuracy / 2;
            var popupContent = "You are here +/-" + radius + " a few meters";

            if (gpsMarker == null) {
                gpsMarker = L.marker(e.latlng,).addTo(mymap);
                gpsMarker.bindPopup(popupContent);
                gpsCircleMarker = L.circle(e.latlng, radius).addTo(mymap);
            }
            else {
                gpsMarker.getPopup().setContent(popupContent);   
                gpsMarker.setLatLng(e.latlng);
                gpsCircleMarker.setLatLng(e.latlng);
                gpsCircleMarker.setRadius(radius);
                }
         }
         mymap.on('locationfound', onLocationFound);
         mymap.locate({setView: false, watch: true});
         // Driving directions?
         // https://stackoverflow.com/a/25839099
         
         
         // What three words?
         //Controls
         L.control.layers(baseMaps, overlayMaps).addTo(mymap);
         L.control.scale().addTo(mymap); //adding scale to map    
       </script>
   </body>
</html>